<html>
    <head></head>  
    <body>
        <div class="container" id="container"></div>
        
        <script>

const container = document.getElementById("container");
const appID = window.location.href.split("/")[4].split("?")[0];
const realm = window.location.href.split("/")[2];
const dependencies = [
        {"src": `/db/${appID}?a=dbpage&pagename=QuickSheetsConfig.js`, "type": "script"},
        {"src": `/db/${appID}?a=dbpage&pagename=qbAPI.js`, "type": "script"},
        {"src": `/db/${appID}?a=dbpage&pagename=QuickSheetsStylesheet.css`, "type": "css"}      
        
    ];

    function loadDependency(src, type) {
    return new Promise((resolve, reject) => {
        let element;
        
        if (type === "script") {
            element = document.createElement("script");
            element.src = src;
            element.async = true;
            element.onload = () => {
                console.log(`Loaded script: ${src}`);
                resolve(src);
            };
            element.onerror = () => {
                console.error(`Failed to load script: ${src}`);
                reject(new Error(`Failed to load ${src}`));
            };
        } else if (type === "css") {
            element = document.createElement("link");
            element.rel = "stylesheet";
            element.href = src;
            element.onload = () => {
                console.log(`Loaded CSS: ${src}`);
                resolve(src);
            };
            
            // Fallback for older browsers (CSS doesn't always trigger onload)
            setTimeout(() => {
                console.log(`Assuming CSS loaded: ${src}`);
                resolve(src);
            }, 1000); // Adjust delay if needed
        } else {
            reject(new Error(`Unknown type: ${type}`));
            return;
        }

        document.head.appendChild(element);
    });
}

// Load all dependencies and run main() when done
Promise.all(dependencies.map(r => loadDependency(r.src, r.type)))
    .then(() => {
        console.log("All resources loaded. Running main().");
        init();
    })
    .catch((error) => {
        console.error("Resource loading failed:", error);
    });


function init(){
	
  container.innerHTML = "";
	let column = document.createElement("div");
  column.classList.add("column");
  
  let heading = document.createElement("h2");
  heading.textContent = "Setup Page";
  
  let installBtn = document.createElement("button");
  installBtn.classList.add("tableButton");
  installBtn.textContent = "Install";
 	installBtn.onclick = () => install();
  
  let editConfigBtn = document.createElement("button");
  editConfigBtn.classList.add("tableButton");
  editConfigBtn.textContent = "Edit Configuration";
  editConfigBtn.onclick = () => editConfig();
  
  column.appendChild(heading);
  column.appendChild(installBtn);
  column.appendChild(editConfigBtn);
  container.appendChild(column);

}

function install(){

	container.innerHTML = "";
  
    let backBtn = document.createElement("button");
    backBtn.classList.add("back-button");
    backBtn.textContent = "Back";
    backBtn.onclick = () => init();

        container.appendChild(backBtn);
    
    }

    function editConfig(){

        container.innerHTML = "";

        let backBtn = document.createElement("button");
    backBtn.classList.add("back-button");
    backBtn.textContent = "Cancel";
    backBtn.onclick = () => init();

        let saveBtn = document.createElement("button");
    saveBtn.classList.add("save-button");
    saveBtn.textContent = "Save";
    saveBtn.onclick = () => init();

        container.appendChild(backBtn);
    container.appendChild(saveBtn);
    }

        </script>

    </body>


</html>